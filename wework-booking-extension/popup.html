<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeWork Desk Booking</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-main">
        <div class="header-title-group">
          <h1>WeWork Desk Booking</h1>
          <p class="header-subtitle">Manage your desk location & bookings</p>
        </div>
        <button id="editLocationBtn" class="header-location-trigger">
          <span id="locationName">RMZ Latitude Commercial, Bengaluru</span>
          <span class="header-location-caret">▾</span>
        </button>
      </div>
      <div class="header-meta">
        <div class="auth-status auth-pill" id="authStatus">
          <span class="status-indicator" id="statusIndicator"></span>
          <span id="authText">Checking authentication...</span>
        </div>
      </div>
    </div>

    <!-- Login Section (shown when not authenticated) -->
    <div class="login-section" id="loginSection" style="display: none;">
      <div class="login-card">
        <h2>Authentication Required</h2>
        <p>Please log in to WeWork or visit <a href="https://members.wework.com" target="_blank">members.wework.com</a> to authenticate.</p>
        <button id="openWeWorkBtn" class="btn btn-primary">Open WeWork</button>
        <button id="refreshTokenBtn" class="btn btn-secondary">Refresh Token</button>
      </div>
    </div>

    <!-- Main Booking Section -->
    <div class="booking-section" id="bookingSection" style="display: none;">
      <!-- Location Info (removed Space ID UI; managed via header dropdown only) -->

      <!-- Location Selector (shown when editing location) -->
      <div class="location-selector" id="locationSelector" style="display: none;">
        <h3>Select Location</h3>
        <div class="location-selector-controls">
          <div class="location-city-select">
            <label for="locationCitySelect">City</label>
            <select id="locationCitySelect">
              <option value="bangalore">Bangalore</option>
              <option value="mumbai">Mumbai</option>
              <option value="hyderabad">Hyderabad</option>
              <option value="pune">Pune</option>
              <option value="gurugram">Gurugram</option>
              <option value="noida">Noida</option>
              <option value="delhi-ncr">Delhi NCR</option>
            </select>
          </div>
          <div class="location-search">
            <label for="locationSearch">Search</label>
            <input
              type="text"
              id="locationSearch"
              placeholder="Search by building or area"
              autocomplete="off"
            />
          </div>
        </div>
        <p id="locationSelectorStatus" class="muted-text">Loading WeWork locations...</p>
        <div id="locationList" class="location-list"></div>
        <div class="location-selector-actions">
          <button id="cancelLocationEditBtn" class="btn btn-secondary btn-small">Cancel</button>
        </div>
      </div>

      <!-- Calendar Container -->
      <div class="calendar-container">
        <div class="calendar-header">
          <button id="prevMonth" class="nav-btn">‹</button>
          <h2 id="currentMonthYear"></h2>
          <button id="nextMonth" class="nav-btn">›</button>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
        <div class="calendar-actions">
          <button id="selectAllBtn" class="btn btn-secondary">Select All</button>
          <button id="clearSelectionBtn" class="btn btn-secondary">Clear</button>
        </div>
      </div>

      <!-- Selected Dates Summary -->
      <div class="selected-dates" id="selectedDates" style="display: none;">
        <h3>Selected Dates (<span id="selectedCount">0</span>)</h3>
        <div class="selected-list" id="selectedList"></div>
      </div>

      <!-- Booking Options -->
      <div class="booking-options">
        <div class="time-settings">
          <label>
            <input type="checkbox" id="skipSundays" checked>
            Skip Sundays
          </label>
          <div class="time-inputs">
            <div>
              <label>Weekday Start:</label>
              <input type="time" id="weekdayStart" value="08:00">
            </div>
            <div>
              <label>Weekday End:</label>
              <input type="time" id="weekdayEnd" value="20:00">
            </div>
            <div>
              <label>Saturday Start:</label>
              <input type="time" id="saturdayStart" value="10:00">
            </div>
            <div>
              <label>Saturday End:</label>
              <input type="time" id="saturdayEnd" value="16:00">
            </div>
          </div>
        </div>
      </div>

      <!-- Progress Section (full-screen overlay while booking) -->
      <div class="progress-section booking-overlay" id="progressSection" style="display: none;">
        <div class="loader-container">
          <div aria-label="Orange and tan hamster running in a metal wheel" role="img" class="wheel-and-hamster">
            <div class="wheel"></div>
            <div class="hamster">
              <div class="hamster__body">
                <div class="hamster__head">
                  <div class="hamster__ear"></div>
                  <div class="hamster__eye"></div>
                  <div class="hamster__nose"></div>
                </div>
                <div class="hamster__limb hamster__limb--fr"></div>
                <div class="hamster__limb hamster__limb--fl"></div>
                <div class="hamster__limb hamster__limb--br"></div>
                <div class="hamster__limb hamster__limb--bl"></div>
                <div class="hamster__tail"></div>
              </div>
            </div>
            <div class="spoke"></div>
          </div>
        </div>
        <p class="progress-text" id="progressText">Processing...</p>
        <div class="booking-progress-details" id="bookingProgressDetails"></div>
      </div>

      <!-- Results Section (full-screen overlay after booking) -->
      <div class="results-section booking-overlay" id="resultsSection" style="display: none;">
        <div class="result-card" id="resultCard">
          <h3 id="resultTitle"></h3>
          <div id="resultDetails" class="result-details"></div>
          <div id="reminderSection" class="reminder-section" style="display: none;">
            <h4>Set Reminder</h4>
            <p class="reminder-description">Get notified before your bookings expire</p>
            <div class="reminder-options">
              <label class="reminder-option">
                <input type="radio" name="reminderDays" value="1" id="reminder1Day">
                <span>1 day before</span>
              </label>
              <label class="reminder-option">
                <input type="radio" name="reminderDays" value="2" id="reminder2Days" checked>
                <span>2 days before</span>
              </label>
              <label class="reminder-option">
                <input type="radio" name="reminderDays" value="3" id="reminder3Days">
                <span>3 days before</span>
              </label>
              <label class="reminder-option">
                <input type="radio" name="reminderDays" value="7" id="reminder7Days">
                <span>1 week before</span>
              </label>
            </div>
            <button id="setReminderBtn" class="btn btn-primary">Set Reminder</button>
          </div>
          <button id="closeResultsBtn" class="btn btn-secondary">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sticky Booking Footer -->
  <div class="booking-footer" id="bookingFooter" style="display: none;">
    <button id="bookAllBtn" class="btn btn-primary btn-large" disabled>
      Book All Selected Dates
    </button>
  </div>

  <script src="popup.js"></script>
</body>
</html>